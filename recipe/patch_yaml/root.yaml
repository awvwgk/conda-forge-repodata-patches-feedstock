# from this snippet
# ROOT 6.22.6 contained an ABI break, we'll always pin on patch releases from now on
# if has_dep(record, "root_base"):
#     for i, dep in enumerate(deps):
#         if not ("root_base" in dep and "<6.23.0a0" in dep):
#             continue
#         if ">=6.22.0," in dep or ">=6.22.2," in dep or ">=6.22.4," in dep:
#             deps.append("root_base <6.22.5a0")
#         elif ">=6.22.6," in dep:
#             deps.append("root_base <6.22.7a0")
if:
  has_depends:
    - root_base *<6.23.0a0*
    - root_base *>=6.22.[024],*
then:
  - add_depends: root_base <6.22.5a0
---
# from the snippet above
if:
  has_depends:
    - root_base *<6.23.0a0*
    - root_base *>=6.22.6,*
then:
  - add_depends: root_base <6.22.7a0
---
# from this snippet
# if record_name == "root_base":
#     # ROOT requires vector-classes to be the exact same version as the one used for the build
#     _replace_pin('vector-classes >=1.4.1,<1.5.0a0', 'vector-classes >=1.4.1,<1.4.2a0', deps, record)
if:
  name: root_base
then:
  - replace_depends:
      old: vector-classes >=1.4.1,<1.5.0a0
      new: vector-classes >=1.4.1,<1.4.2a0
---
# root_base 6.36.06 build 4 (from conda-forge/root-feedstock#333) dropped the
# sysroot version pin. ROOT's cling JIT compiler uses the conda sysroot headers
# at runtime, so the sysroot version must match what ROOT was built against.
# Without this constraint, the solver picks sysroot 2.28, causing
# "redefinition of 'timespec'" errors when cling tries to #include <Python.h>.
# See https://github.com/scikit-hep/awkward/actions/runs/22073349438
if:
  name: root_base
  version: "6.36.06"
  build_number_in: [4]
  subdir_in: linux-64
  has_depends: "sysroot_linux-64"
  timestamp_lt: 1771323458000
then:
  - replace_depends:
      old: sysroot_linux-64
      new: sysroot_linux-64 2.17.*
---
if:
  name: root_base
  version: "6.36.06"
  build_number_in: [4]
  subdir_in: linux-aarch64
  has_depends: "sysroot_linux-aarch64"
  timestamp_lt: 1771323458000
then:
  - replace_depends:
      old: sysroot_linux-aarch64
      new: sysroot_linux-aarch64 2.17.*
---
if:
  name: root_base
  version: "6.36.06"
  build_number_in: [4]
  subdir_in: linux-ppc64le
  has_depends: "sysroot_linux-ppc64le"
  timestamp_lt: 1771323458000
then:
  - replace_depends:
      old: sysroot_linux-ppc64le
      new: sysroot_linux-ppc64le 2.17.*
